= Habitree – User Stories & Sequenzdiagramme
:toc:
:toclevels: 3

== US #250 – Login

Als Nutzer möchte ich mich anmelden können, um Zugriff auf meine persönlichen Habits zu erhalten.

image::login.png[width=600,align=center]

[source,mermaid]
----
sequenceDiagram
    autonumber
    actor Nutzer as Nutzer
    participant Expo as Expo App (React Native)
    participant FEAuth as useAuthController
    participant ApiRepo as ApiAuthRepository
    participant Express as Express Router (/auth)
    participant Prisma as Prisma ORM
    participant PG as PostgreSQL (HabitTrackerDatabase)

    Nutzer->>Expo: E-Mail & Passwort eingeben
    Expo->>FEAuth: login(email, password)
    FEAuth->>ApiRepo: POST /auth/login

    ApiRepo->>Express: HTTP Request (email, password)
    Express->>Prisma: prisma.user.findUnique({ email })
    Prisma->>PG: SELECT * FROM "User" WHERE email = ...
    PG-->>Prisma: UserRecord
    Prisma-->>Express: UserRecord

    alt User nicht gefunden
        Express-->>ApiRepo: 401 Unauthorized
        ApiRepo-->>FEAuth: Fehler
        FEAuth-->>Expo: Fehlermeldung anzeigen
    else User gefunden
        Express->>Express: Passwortvergleich (bcrypt.compare)
        alt Passwort korrekt
            Express->>Express: JWT Token erzeugen
            Express-->>ApiRepo: 200 OK (token, user)
            ApiRepo-->>FEAuth: token + user
            FEAuth-->>Expo: Login erfolgreich
        else Passwort falsch
            Express-->>ApiRepo: 401 Unauthorized
            ApiRepo-->>FEAuth: Fehler
            FEAuth-->>Expo: Fehlermeldung anzeigen
        end
    end
----


== US #250 – Registrierung

Als Nutzer möchte ich ein Konto erstellen können, um die App nutzen zu können.

image::register.png[width=600,align=center]

[source,mermaid]
----
sequenceDiagram
    autonumber
    actor Nutzer as Nutzer
    participant Expo as Expo App (React Native)
    participant FEAuth as useAuthController
    participant ApiRepo as ApiAuthRepository
    participant Express as Express Router (/auth)
    participant Prisma as Prisma ORM
    participant PG as PostgreSQL (HabitTrackerDatabase)

    Nutzer->>Expo: Registrierungsdaten eingeben
    Expo->>FEAuth: register(data)
    FEAuth->>ApiRepo: POST /auth/register

    ApiRepo->>Express: HTTP Request (email, password, name)
    Express->>Prisma: prisma.user.create({ data })
    Prisma->>PG: INSERT INTO "User"
    PG-->>Prisma: CreatedUser
    Prisma-->>Express: CreatedUser
    Express-->>ApiRepo: 201 Created (user)
    ApiRepo-->>FEAuth: user
    FEAuth-->>Expo: Registrierung erfolgreich
----


== US #250 – Logout

Als Nutzer möchte ich mich ausloggen können, um mein Konto zu schützen.

image::logout.png[width=600,align=center]

[source,mermaid]
----
sequenceDiagram
    autonumber
    participant Expo as Expo App
    participant FEAuth as useAuthController

    Expo->>FEAuth: logout()
    FEAuth->>FEAuth: Token löschen
    FEAuth-->>Expo: Navigation zum LoginScreen
----


== US #108 – Habit erstellen

Als Nutzer möchte ich ein Habit erstellen können, um meine Ziele zu planen.

image::habit-erstellen.png[width=600,align=center]

[source,mermaid]
----
sequenceDiagram
    autonumber
    actor Nutzer as Nutzer
    participant Expo as Expo App (React Native)
    participant FEHabit as useHabitController
    participant ApiRepo as ApiHabitRepository
    participant Express as Express Router (/habits)
    participant Prisma as Prisma ORM
    participant PG as PostgreSQL (HabitTrackerDatabase)

    Nutzer->>Expo: Habit-Daten eingeben
    Expo->>FEHabit: createHabit(habitData)
    FEHabit->>ApiRepo: POST /habits (habitData)

    ApiRepo->>Express: HTTP Request (JSON HabitData)
    Express->>Express: Validierung der Felder (label vorhanden?)

    alt label fehlt
        Express-->>ApiRepo: 400 Bad Request
        ApiRepo-->>FEHabit: Fehler
        FEHabit-->>Expo: Fehlermeldung anzeigen
    else label ok
        Express->>Prisma: prisma.habit.create({ data: habitData })
        Prisma->>PG: INSERT INTO Habit (...)
        PG-->>Prisma: CreatedHabitRecord
        Prisma-->>Express: HabitRecord

        Express-->>ApiRepo: 201 Created (Habit)
        ApiRepo-->>FEHabit: Habit zurückgeben
        FEHabit-->>Expo: Habit erfolgreich erstellt
    end
----


== US #298 – Habit abhaken

Als Nutzer möchte ich ein Habit abhaken können, um meinen Fortschritt zu dokumentieren.

image::habit-abhaken.png[width=600,align=center]

[source,mermaid]
----
sequenceDiagram
    autonumber
    participant Expo as Expo App (React Native)
    participant FEHabit as useHabitController
    participant ApiRepo as ApiHabitRepository
    participant Express as Express Router (/habits)
    participant Prisma as Prisma ORM
    participant PG as PostgreSQL (HabitTrackerDatabase)

    Expo->>FEHabit: toggleHabit(id)
    FEHabit->>ApiRepo: PATCH /habits/:id
    ApiRepo->>Express: HTTP Request
    Express->>Prisma: prisma.habit.update()
    Prisma->>PG: UPDATE "Habit"
    PG-->>Prisma: UpdatedHabit
    Prisma-->>Express: UpdatedHabit
    Express-->>ApiRepo: UpdatedHabit
    ApiRepo-->>FEHabit: UpdatedHabit
    FEHabit-->>Expo: UI aktualisieren
----


== US #93 – Habit-Liste abrufen

Als Nutzer möchte ich meine Habits sehen können, um meinen Fortschritt zu verfolgen.

image::habit-liste.png[width=600,align=center]

[source,mermaid]
----
sequenceDiagram
    autonumber
    participant Expo as Expo App (React Native)
    participant FEHabit as useHabitController
    participant ApiRepo as ApiHabitRepository
    participant Express as Express Router (/habits)
    participant Prisma as Prisma ORM
    participant PG as PostgreSQL (HabitTrackerDatabase)

    Expo->>FEHabit: getHabits()
    FEHabit->>ApiRepo: GET /habits
    ApiRepo->>Express: HTTP Request
    Express->>Prisma: prisma.habit.findMany()
    Prisma->>PG: SELECT * FROM "Habit"
    PG-->>Prisma: HabitList
    Prisma-->>Express: HabitList
    Express-->>ApiRepo: HabitList
    ApiRepo-->>FEHabit: HabitList
    FEHabit-->>Expo: HabitList anzeigen
----

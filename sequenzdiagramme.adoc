= Habitree – Sequenzdiagramme & User Stories
Laurenz
:toc:
:toclevels: 3

== Einleitung

Diese Dokumentation beschreibt zentrale User Stories der Habitree-App sowie die dazugehörigen Sequenzdiagramme.  

== User Stories

=== US #250 – Anmeldung und Registrierung
Als Nutzer möchte ich mich registrieren und anmelden können, damit ich meinen Fortschritt speichern und verfolgen kann.

=== US #93 – Übersicht der erstellten Habits
Als Nutzer möchte ich eine Liste meiner Habits sehen, um meinen Fortschritt zu verfolgen.

=== US #298 – Erfolgreich abgeschlossenes Habit
Als Nutzer möchte ich ein Habit abhaken können, um meinen täglichen Fortschritt zu dokumentieren.

=== US #108 – Habit erstellen / Zeitplan festlegen
Als Nutzer möchte ich ein Habit mit Wiederholungsintervallen erstellen, um meine Ziele strukturiert zu planen.

== Sequenzdiagramme

=== 1. Login (US #250)

[mermaid]
----
sequenceDiagram
    autonumber
    actor Nutzer as Nutzer
    participant Expo as Expo App (React Native)
    participant FEAuth as useAuthController
    participant ApiRepo as ApiAuthRepository
    participant Express as Express Router (/auth)
    participant Prisma as Prisma ORM
    participant PG as PostgreSQL (HabitTrackerDatabase)

    Nutzer->>Expo: E-Mail & Passwort eingeben
    Expo->>FEAuth: login(email, password)
    FEAuth->>ApiRepo: POST /auth/login

    ApiRepo->>Express: HTTP Request (email, password)
    Express->>Prisma: prisma.user.findUnique({ email })
    Prisma->>PG: SELECT * FROM "User" WHERE email = ...
    PG-->>Prisma: UserRecord
    Prisma-->>Express: UserRecord

    alt User nicht gefunden
        Express-->>ApiRepo: 401 Unauthorized
        ApiRepo-->>FEAuth: Fehler
        FEAuth-->>Expo: Fehlermeldung anzeigen
    else User gefunden
        Express->>Express: Passwortvergleich (bcrypt.compare)
        alt Passwort korrekt
            Express->>Express: JWT Token erzeugen
            Express-->>ApiRepo: 200 OK (token, user)
            ApiRepo-->>FEAuth: token + user
            FEAuth-->>Expo: Login erfolgreich
        else Passwort falsch
            Express-->>ApiRepo: 401 Unauthorized
            ApiRepo-->>FEAuth: Fehler
            FEAuth-->>Expo: Fehlermeldung anzeigen
        end
    end
----

=== 2. Habit-Liste abrufen (US #93)

[mermaid]
----
sequenceDiagram
    autonumber
    participant Expo as Expo App (React Native)
    participant FEHabit as useHabitController
    participant ApiRepo as ApiHabitRepository
    participant Express as Express Router (/habits)
    participant Prisma as Prisma ORM
    participant PG as PostgreSQL (HabitTrackerDatabase)

    Expo->>FEHabit: getHabits()
    FEHabit->>ApiRepo: GET /habits
    ApiRepo->>Express: HTTP Request
    Express->>Prisma: prisma.habit.findMany()
    Prisma->>PG: SELECT * FROM "Habit"
    PG-->>Prisma: HabitList
    Prisma-->>Express: HabitList
    Express-->>ApiRepo: HabitList
    ApiRepo-->>FEHabit: HabitList
    FEHabit-->>Expo: HabitList anzeigen
----

=== 3. Habit erstellen (US #108)

[mermaid]
----
sequenceDiagram
    autonumber
    actor Nutzer as Nutzer
    participant Expo as Expo App (React Native)
    participant FEHabit as useHabitController
    participant ApiRepo as ApiHabitRepository
    participant Express as Express Router (/habits)
    participant Prisma as Prisma ORM
    participant PG as PostgreSQL (HabitTrackerDatabase)

    Nutzer->>Expo: Habit-Daten eingeben (label, description, checked)
    Expo->>FEHabit: createHabit(habitData)
    FEHabit->>ApiRepo: POST /habits (habitData)

    ApiRepo->>Express: HTTP Request (JSON HabitData)
    Express->>Express: Validierung der Felder (label vorhanden?)

    alt label fehlt
        Express-->>ApiRepo: 400 Bad Request
        ApiRepo-->>FEHabit: Fehler
        FEHabit-->>Expo: Fehlermeldung anzeigen
    else label ok
        Express->>Prisma: prisma.habit.create({ data: habitData })
        Prisma->>PG: INSERT INTO Habit (...)
        PG-->>Prisma: CreatedHabitRecord
        Prisma-->>Express: HabitRecord

        Express-->>ApiRepo: 201 Created (Habit)
        ApiRepo-->>FEHabit: Habit zurückgeben
        FEHabit-->>Expo: Habit erfolgreich erstellt
    end
----

=== 4. Habit abhaken (US #298)

[mermaid]
----
sequenceDiagram
    autonumber
    participant Expo as Expo App (React Native)
    participant FEHabit as useHabitController
    participant ApiRepo as ApiHabitRepository
    participant Express as Express Router (/habits)
    participant Prisma as Prisma ORM
    participant PG as PostgreSQL (HabitTrackerDatabase)

    Expo->>FEHabit: toggleHabit(id)
    FEHabit->>ApiRepo: PATCH /habits/:id
    ApiRepo->>Express: HTTP Request
    Express->>Prisma: prisma.habit.update()
    Prisma->>PG: UPDATE "Habit"
    PG-->>Prisma: UpdatedHabit
    Prisma-->>Express: UpdatedHabit
    Express-->>ApiRepo: UpdatedHabit
    ApiRepo-->>FEHabit: UpdatedHabit
    FEHabit-->>Expo: UI aktualisieren
----

=== 5. Login erfolgreich (US #250 – Folgeaktion)

[mermaid]
----
sequenceDiagram
    autonumber
    participant Expo as Expo App
    participant FEAuth as useAuthController

    FEAuth->>Expo: storeToken(token)
    Expo->>Expo: Navigation zur HabitList
----

=== 3.6 Habit-Liste nach Erstellung aktualisieren (US #108)

[mermaid]
----
sequenceDiagram
    autonumber
    participant FEHabit as useHabitController
    participant ApiRepo as ApiHabitRepository
    participant Express as Express Router (/habits)
    participant Prisma as Prisma ORM
    participant PG as PostgreSQL (HabitTrackerDatabase)

    FEHabit->>ApiRepo: GET /habits
    ApiRepo->>Express: HTTP Request
    Express->>Prisma: prisma.habit.findMany()
    Prisma->>PG: SELECT * FROM "Habit"
    PG-->>Prisma: HabitList
    Prisma-->>Express: HabitList
    Express-->>ApiRepo: HabitList
    ApiRepo-->>FEHabit: HabitList
----

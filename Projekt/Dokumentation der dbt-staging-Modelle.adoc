= Dokumentation der Staging-Modelle `stg_students_clean` und `stg_students_with_credits` 
:author: Paul Händler
:revdate: 2025-10-30
:doctype: book
:toc: left
:toclevels: 2

== Überblick

Dieses Dokument beschreibt die dbt-Modelle `stg_students_clean` und `stg_students_with_credits`.  
Beide Modelle sind Teil der **Staging-Schicht** innerhalb der QIS-Insights-Pipeline und dienen der Bereinigung, Validierung und Anreicherung von Studierendendaten.

* `stg_students_clean` stellt saubere und standardisierte Grunddaten bereit.  
* `stg_students_with_credits` erweitert diese um Modulmetadaten, Credit-Informationen und semantische Zusatzfelder (z. B. Terminzählung, Abweichungen vom Studienplan).

== Einordnung in die dbt-Pipeline

Die Modelle `stg_students_clean` und `stg_students_with_credits` gehören zur **Staging-Schicht** der dbt-Pipeline.  
Diese Schicht ist die erste Ebene nach dem Laden der Rohdaten (Raw Layer) und dient dazu, Daten zu **bereinigen, zu standardisieren und zu validieren**, bevor sie in analytische Modelle überführt werden.

=== Aufgaben der Staging-Schicht

* Vereinheitlichung von Spaltennamen und Datentypen  
* Bereinigung von Dubletten und fehlerhaften Werten  
* Validierung über `not_null`- und `accepted_values`-Tests  
* Bildung von einheitlichen ENUM-Werten (z. B. `WiSe`, `SoSe`, `bestanden`, `krank`)  
* Vorbereitung der Daten für nachgelagerte Modelle (z. B. Performance-, Trend- oder Studienverlaufsanalysen)

=== Position im dbt-Schichtenmodell

[plantuml, dbt_layer_diagram, svg]
----
@startuml
skinparam backgroundColor #ffffff
skinparam rectangle {
  BackgroundColor #f5f5f5
  BorderColor #999999
  RoundCorner 10
}
skinparam note {
  BackgroundColor #fffbe6
  BorderColor #c2b900
}

rectangle "Raw Layer\n(z. B. students_final.db, module.csv)" as raw
rectangle "Staging Layer\n(`stg_students_clean`\n`stg_students_with_credits`)" as staging
rectangle "Data Marts / Intermediate\n(`mart_student_progress`, `mart_exam_stats`)" as marts
rectangle "Analytics / Dashboard\n(QIS-Insights-Frontend)" as analytics

raw -down-> staging : Transformation & Validierung
staging -down-> marts : Aggregation & Ableitung
marts -down-> analytics : Visualisierung & Analyse

note right of staging
  * Vereinheitlichung der Felder
  * ENUM-Validierung
  * Bereinigung fehlerhafter Einträge
end note
@enduml
----

=== Projektstruktur in dbt

[source,bash]
----
dbt/
└── qis-insight/
    └── models/
        └── staging/
            ├── stg_students_clean.sql
            ├── stg_students_with_credits.sql
            └── schema.yml
----

Der Namenspräfix `stg_` kennzeichnet Modelle der **Staging-Schicht** – also technisch bereinigte Zwischentabellen,  
die nicht direkt für Endnutzer bestimmt sind, sondern der Sicherung der Datenqualität dienen.

== Modell: `stg_students_clean`

=== Zweck

Dieses Modell enthält **bereinigte, validierte und standardisierte Studierendendaten**.  
Es definiert ENUM-Typen, filtert fehlerhafte Einträge und legt die Basis für die nachfolgenden Modelle.

=== schema.yml - Definition des Modells

[source,yaml]
----
version: 2

models:
  - name: stg_students_clean
    description: "Cleaned and standardized student grades data with validated enums and filtered invalid records"
    columns:
      - name: studentID
        description: "Student identifier"
      - name: Modulnummer
        description: "Module number (e.g., I143, W825). Module names sourced separately."
      - name: Note
        description: "Cleaned grade as string"
      - name: Status
        description: "Status of the final exam grade"
      - name: term_counter
        description: "Term counter for student (1, 2, 3, etc.)"
      - name: ImmaJahr
        description: "Immatriculation year (first year student has any entry)"
      - name: ImmaSemester
        description: "Semester in which student started (WiSe or SoSe)"
----

=== Spaltenbeschreibung

|===
| Spalte | Beschreibung

| `studentID` | Eindeutige Kennung des Studierenden  
| `Modulnummer` | Modulcode (z. B. I143, W825)  
| `Note` | Bereinigte Note als String  
| `Status` | Prüfungsstatus (z. B. *bestanden*, *nicht bestanden*, *abgemeldet*)  
| `term_counter` | Laufende Semesterzählung pro Student  
| `ImmaJahr` | Jahr der Erstimmatrikulation  
| `ImmaSemester` | Semester der Erstimmatrikulation (*WiSe* oder *SoSe*)  
|===

=== SQL-Implementierung `stg_students_clean.sql`


==== Konfiguration & Domänentypen

[source,sql]
----
{{ config(
    pre_hook=[
        "CREATE TYPE IF NOT EXISTS academic_semester AS ENUM ('WiSe', 'SoSe');",
        "CREATE TYPE IF NOT EXISTS exam_remark AS ENUM ('abgemeldet', 'anerkannt', 'krank', 'nicht zugelassen', 'unentschuldigt gefehlt');",
        "CREATE TYPE IF NOT EXISTS exam_status AS ENUM ('bestanden', 'nicht bestanden', 'abgemeldet');"
    ]
) }}
----
*Warum?* Die `pre_hook`s definieren **ENUM-Typen** für Semester, Vermerk und Status, sofern diese noch nicht vorhanden sind.

==== Transformationslogik

===== 1) `source_data` – Filter nur auf Hauptnoten (Entfernt Teilnoten)
[source,sql]
----
with source_data as (
  select * from students
  where Modul not like '%APL%'
    and Modul not like '%SPL%'
    and Modul not like '%PVL%'
    and Modul not like '%MP%'
    and Modul not like '%schriftlicher Teil%'
    and Modul not like '%mündlicher Teil%'
    and Modul not like '%SP%'
    and Modul not like '%Semesterarbeit%'
    and Modul not like '%BGA%'
    and Modul not like '%Beleg%'
    and Modul not like '%schriftlich%'
    and Modul not like '%Verteidigung%'
    and Modul not like '%schriftliche Arbeit%'
),
----
*Ziel:* Nur **Endnoten** behalten (keine Zwischen-/Teilprüfungen).

===== 2) `module_mapping` – Modulnummern ableiten/korrigieren
[source,sql]
----
module_mapping as (
  select
    *,
    case
      when Modulnummer is null and Modul like '%Wahlpflichtmodul (Ausnahme)%' then 'XWM'
      when Modulnummer is null and Modul like '%Zusatzmodul%'                 then 'XZM'
      when Modulnummer is null and Modul like '%Forschungs-/Entwicklungsprojekt%' then 'I705'
      else Modulnummer
    end as Modulnummer_mapped
  from source_data
),
----
*Hinweis:* Platzhalter `XWM` (Wahlpflicht), `XZM` (Zusatz), `I705` (F&E-Projekt).

===== 3) `cleaned` – Kernbereinigung (Noten, Status, Semester, Jahr, Vermerk)
[source,sql]
----
cleaned as (
  select
    studentID,
    Modulnummer_mapped as Modulnummer,
    Studienrichtung,
    Note          as Note_original,
    Vermerk       as Vermerk_original,

    -- a) Note bereinigen
    case
      when Note = '10' then '1,0'
      when Note in ('0,0 mE','02.01.1900','angemeldet') then null
      when Note = 'bestanden' then null
      when Note is not null then trim(regexp_replace(Note,'[\r\n\t\s]+','','g'))
      else null
    end as Note_cleaned,

    -- b) Note als Zahl
    case
      when Note = '10' then 1.0
      when Note_cleaned is null then null
      else try_cast(replace(Note_cleaned, ',', '.') as decimal(3,1))
    end as Note_numeric,

    -- c) Vorläufiger Prüfungsstatus
    case
      when Note = 'bestanden' then 'bestanden'
      when (Note_cleaned is null or Note_cleaned = '') and Vermerk = 'mit Erfolg' then 'bestanden'
      when Note is null and Vermerk is null then 'abgemeldet'
      when Vermerk in ('krank','nicht zugelassen') then 'abgemeldet'
      when Note = 'angemeldet' and Vermerk is null then 'abgemeldet'
      when Vermerk = 'unentschuldigt gefehlt' then 'nicht bestanden'
      when Note_numeric between 1.0 and 4.0 then 'bestanden'
      when Note_numeric = 5.0 then 'nicht bestanden'
      when Vermerk = 'abgemeldet' and Note_numeric = 5.0 then 'nicht bestanden'
      when Vermerk = 'abgemeldet' then 'abgemeldet'
      when Note_cleaned is not null and Note_cleaned <> '' then 'bestanden'
      else null
    end as exam_status_temp,

    -- d) Semester normalisieren
    case
      when upper(Semester) = 'WISE' then 'WiSe'
      when upper(Semester) = 'SOSE' then 'SoSe'
      else Semester
    end as Semester_cleaned,

    -- e) Jahr bereinigen
    case
      when Jahr = 29 then 19
      when Jahr between 11 and 25 then Jahr
      else null
    end as Jahr_cleaned,

    -- f) Vermerk bereinigen
    case
      when Note = '5' and Vermerk <> 'unentschuldigt gefehlt' then null
      when Vermerk = 'krank' then null
      when Vermerk in ('mit Erfolg','kein Antrag') then null
      when Vermerk in ('abgemeldet','anerkannt','krank','nicht zugelassen','unentschuldigt gefehlt') then Vermerk
      else null
    end as Vermerk_cleaned

  from module_mapping
)
----
==== 4) Finale Projektion & Typisierung
[source,sql]
----
select
  studentID,
  Modulnummer,
  Note_cleaned  as Note,
  Note_numeric,
  cast(exam_status_temp as exam_status)           as Status,
  cast(Semester_cleaned as academic_semester)     as Semester,
  Jahr_cleaned                                     as Jahr,
  cast(Vermerk_cleaned as exam_remark)            as Vermerk,
  Studienrichtung
from cleaned
where not (
  Note_cleaned   is null
  and Jahr_cleaned is null
  and Semester_cleaned is null
  and Vermerk_cleaned  is null
)
----

==== Logik kompakt (Tabellen)

===== Statusableitung (Auszug)
|===
| Bedingung | Ergebnis
| `Note = 'bestanden'` | *bestanden*
| `Note_cleaned NULL` & `Vermerk='mit Erfolg'` | *bestanden*
| `Note NULL` & `Vermerk NULL` | *abgemeldet*
| `Vermerk in ('krank','nicht zugelassen')` | *abgemeldet*
| `Note='angemeldet'` & `Vermerk NULL` | *abgemeldet*
| `Vermerk='unentschuldigt gefehlt'` | *nicht bestanden*
| `1.0 ≤ Note_numeric ≤ 4.0` | *bestanden*
| `Note_numeric = 5.0` | *nicht bestanden*
| `Vermerk='abgemeldet'` & `Note_numeric=5.0` | *nicht bestanden*
| `Vermerk='abgemeldet'` (sonst) | *abgemeldet*
| `Note_cleaned not null` | *bestanden*
|===

===== Vermerkbereinigung
|===
| Fall | Aktion
| `Note='5'` & Vermerk ≠ `unentschuldigt gefehlt` | Vermerk → `NULL`
| `Vermerk='krank'` | Vermerk → `NULL`
| `Vermerk in ('mit Erfolg','kein Antrag')` | Vermerk → `NULL`
| Vermerk ∈ {abgemeldet, anerkannt, krank, nicht zugelassen, unentschuldigt gefehlt} | Vermerk bleibt
| Sonstiges | Vermerk → `NULL`
|===

==== Edge Cases & Hinweise

* `Note='10'` als *1,0* ist projektspezifisch – dokumentieren & testen.
* `Jahr=29 → 19` ist ein gezielter Tippfehler-Fix.
* Neue Teilprüfungsarten ⇒ **Filterliste** in `source_data` erweitern.
* Neue Vermerke/Status ⇒ **ENUMs + Logik** synchron anpassen.

---

== Modell: `stg_students_with_credits`

=== Zweck

Dieses Modell erweitert `stg_students_clean` um **Credit-Informationen, Studienrichtungs- und Planbezüge**.  
Es stellt eine vollständig angereicherte Version der Studierendendaten dar, die direkt in Marts oder Analysen überführt werden kann.

=== schema.yml - Definition des Modells

[source,yaml]
----
  - name: stg_students_with_credits
    description: "Student grades enriched with module metadata and earned credits"
    columns:
      - name: studentID
        description: "Student identifier"
        tests:
          - not_null
      
      - name: Modulnummer
        description: "Module number"
        tests:
          - not_null
      
      - name: Note
        description: "Cleaned grade as string"
      
      - name: Status
        description: "Exam status (bestanden, nicht bestanden, abgemeldet)"
        tests:
          - not_null
          - accepted_values:
              values: ['bestanden', 'nicht bestanden', 'abgemeldet']
      
      - name: Semester
        description: "Semester when module was taken (WiSe or SoSe)"
        tests:
          - not_null
          - accepted_values:
              values: ['WiSe', 'SoSe']
      
      - name: Jahr
        description: "Year when module was taken"
        tests:
          - not_null
      
      - name: Vermerk
        description: "Special remarks about the grade"
      
      - name: Studienrichtung
        description: "Study program code"
        tests:
          - not_null
      
      - name: term_counter
        description: "Term counter for student"
        tests:
          - not_null
      
      - name: ImmaJahr
        description: "Immatriculation year"
        tests:
          - not_null
      
      - name: StudienOrdnungJahr
        description: "Curriculum version year (11 or 18)"
        tests:
          - not_null
          - accepted_values:
              values: [11, 18]
              quote: false
      
      - name: ImmaSemester
        description: "Semester student started"
        tests:
          - not_null
          - accepted_values:
              values: ['WiSe', 'SoSe']
      
      - name: earned_credits
        description: "Credits earned (only on first pass)"
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 30
      
      - name: PlanDif
        description: "Plan difference (term_counter - module_semester). Negative means earlier than planned, positive means later"
      
      - name: match_quality
        description: "Quality of module match (0=perfect, 1=wrong direction, 2=wrong semester, 3=worst)"
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3]
              quote: false
      
      - name: NichtImPlan
        description: "True if module not in plan"
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      
      - name: Modulnamen
        description: "Module name from module table"
        tests:
          - not_null
----

=== Erweiterte Felder

|===
| Spalte | Beschreibung

| `StudienOrdnungJahr` | Jahr der gültigen Studienordnung (z. B. 11 = 2011, 18 = 2018)  
| `match_quality` | Qualitätsmaß für Modulzuordnung (0–3)  
| `NichtImPlan` | Boolescher Wert, ob das Modul außerhalb des Studienplans liegt  
| `earned_credits` | Vergebene Leistungspunkte (0–30 ECTS)  
| `PlanDif` | Abweichung vom geplanten Studiensemester  
|===

=== SQL-Implementierung `stg_students_with_credits.sql`

==== Eingaben & Abhängigkeiten

* Primär: `stg_students_clean` (siehe oben).
* Stammdaten (Beispielstruktur, aus Modulverzeichnis/CSV importiert):
+
[source,sql]
----
-- Beispielspalten (siehe bereitgestellte CSV):
-- AbJahr, Modulnummer, Modul, Art, Credits, Semester, Wochenstunden,
-- Studienrichtung, Richtung, Professor, PVL, APL,
-- schriftliche Prüfung, mündliche Prüfung
----
*Konvention:* Credits sind in den Stammdaten *pro Modul* definiert.

==== Kernregeln zur Credit-Vergabe

. **Eligibility:** Credits werden vergeben bei `Status='bestanden'` *oder* `Vermerk='anerkannt'`.
. **Einmaligkeit:** Je `studentID` × `Modulnummer` **max. einmal** – auch wenn mehrfach bestanden (z. B. Wiederholungen, Mehrfacheinträge).
. **Zeitpunkt:** Die *erste* bestandene/anerkennende Instanz bestimmt den Vergabezeitpunkt (nach Jahr→Semester sortiert).
. **Sonderfall `I705` (F&E-Projekt):** Credits **einmalig** je Modul vergeben, auch wenn mehrere Einträge als bestanden vorliegen.
. **Kein Credit** bei `Status in ('abgemeldet','nicht bestanden')`.

==== Transformationsschritte (konzeptionell)

[source,sql]
----
with base as (
  select *
  from {{ ref('stg_students_clean') }}
),

catalog as (
  select
    Modulnummer,
    Credits::integer as Credits_catalog,
    Modul,
    Studienrichtung,
    /* weitere Felder aus dem Katalog nach Bedarf */
  from {{ source('catalog', 'modules') }}  -- oder die importierte CSV-Tabelle
),

joined as (
  select
    b.studentID,
    b.Modulnummer,
    b.Semester,
    b.Jahr,
    b.Status,
    b.Vermerk,
    b.Note_numeric,
    b.Studienrichtung as Studienrichtung_student,
    c.Credits_catalog,
    c.Modul as Modulname
  from base b
  left join catalog c using (Modulnummer)
),

mark_passes as (
  select
    *,
    case
      when Status = 'bestanden' or Vermerk = 'anerkannt' then 1 else 0
    end as is_eligible
  from joined
),

first_pass as (
  select
    *,
    row_number() over (
      partition by studentID, Modulnummer
      order by coalesce(Jahr, 99), case when Semester='SoSe' then 1 when Semester='WiSe' then 2 else 9 end
    ) as rn_chron,
    sum(is_eligible) over (
      partition by studentID, Modulnummer
      order by coalesce(Jahr, 99), case when Semester='SoSe' then 1 when Semester='WiSe' then 2 else 9 end
      rows between unbounded preceding and current row
    ) as eligible_seen
  from mark_passes
),

awarded as (
  select
    *,
    case
      when is_eligible = 1
       and (eligible_seen = 1)         -- erste eligible-Instanz
      then Credits_catalog
      else 0
    end as Credits_awarded
  from first_pass
)

select
  studentID,
  Modulnummer,
  Modulname,
  Semester,
  Jahr,
  Status,
  Vermerk,
  Note_numeric,
  Credits_catalog,
  Credits_awarded,
  Studienrichtung_student
from awarded
----
*Anmerkung:* Für Module ohne Katalogeintrag (`Credits_catalog is null`) werden standardmäßig **0** vergeben, außer es gibt projektspezifische Default-Regeln.

==== Ausgabeschema (wichtigste Spalten)

|===
| Spalte | Typ | Beschreibung
| `studentID` | int | Schlüssel Student
| `Modulnummer` | varchar | Kanonische Modulnummer (inkl. `XWM`/`XZM`/`I705`)
| `Modulname` | varchar | Bezeichnung aus Katalog (falls vorhanden)
| `Semester` | `academic_semester` | SoSe/WiSe (bereinigt)
| `Jahr` | int | zweistellige Jahreszahl (bereinigt)
| `Status` | `exam_status` | *bestanden*, *nicht bestanden*, *abgemeldet*
| `Vermerk` | `exam_remark` | Kanonischer Vermerk oder `NULL`
| `Note_numeric` | decimal(3,1) | numerische Note
| `Credits_catalog` | int | Credits laut Modulstamm
| `Credits_awarded` | int | vergebene Credits (0 oder Katalog-Wert; **einmalig je Student×Modul**)
| `Studienrichtung_student` | varchar | Studienrichtung laut Studentendaten
|===


=== Edge Cases & Hinweise

* **Mehrfachversuche:** Wiederholte *bestanden*-Einträge erhöhen **nicht** die Credits.
* **Anerkennung:** `Vermerk='anerkannt'` vergibt Credits auch ohne Note.
* **Wahl-/Zusatzmodule (`XWM`, `XZM`):** Falls Credits katalogseitig variieren, projektspezifische Zuordnung dokumentieren oder `Credits_catalog` pflegen.
* **Zeitordnung:** Sortierung der Erstvergabe über `Jahr` und `Semester` (SoSe vor WiSe). Fehlt beides, fällt der Eintrag hinten an.


== Qualitätssicherung und Tests

* **ENUM-Typen** sind zentralisiert (siehe Hooks in `stg_students_clean`).
* **Tests (dbt):**
** `unique`/`not_null` auf Schlüsselspalten (z. B. `studentID`, `Modulnummer`).
** `accepted_values` für ENUM-Spalten.
** Custom-Test: Einmaligkeit der Credit-Vergabe.
* **Logging:** Anomalien (fehlende Katalog-Credits, ungewöhnliche Jahr/Semester-Kombinationen) zählen und reporten.

=== Testbefehl

Die Datenvalidierung der Modelle (`stg_students_clean` und `stg_students_with_credits`) erfolgt über `dbt test`.

[source,bash]
----
uv run dbt test --profiles-dir ./profiles
----

Dieser Befehl führt alle im Projekt definierten Tests (z. B. `not_null`, `unique`, `accepted_values`, `dbt_expectations`) gegen die Staging-Modelle aus.  
Dadurch wird geprüft, ob Spalten gültige Werte enthalten, Typen korrekt zugeordnet sind und keine Dateninkonsistenzen vorliegen.

=== Beispielhafte Testausgabe (`dbt test`)

[source,terminal]
----
12:34:35  Found 2 models, 1 seed, 21 data tests, 705 macros
12:34:35
12:34:35  Concurrency: 4 threads (target='dev')
12:34:35
12:34:35  1 of 21 START test accepted_values_stg_students_with_credits_ImmaSemester__WiSe__SoSe  [RUN]
12:34:35  2 of 21 START test accepted_values_stg_students_with_credits_NichtImPlan__True__False  [RUN]
12:34:35  3 of 21 START test accepted_values_stg_students_with_credits_Semester__WiSe__SoSe  [RUN]
12:34:35  4 of 21 START test accepted_values_stg_students_with_credits_Status__bestanden__nicht_bestanden__abgemeldet  [RUN]
12:34:35  4 of 21 PASS accepted_values_stg_students_with_credits_Status__bestanden__nicht_bestanden__abgemeldet  [PASS in 0.20s]
12:34:35  5 of 21 START test accepted_values_stg_students_with_credits_StudienOrdnungJahr__False__11__18  [RUN]
12:34:35  3 of 21 PASS accepted_values_stg_students_with_credits_Semester__WiSe__SoSe .... [PASS in 0.27s]
12:34:35  1 of 21 PASS accepted_values_stg_students_with_credits_ImmaSemester__WiSe__SoSe  [PASS in 0.28s]
12:34:35  2 of 21 PASS accepted_values_stg_students_with_credits_NichtImPlan__True__False  [PASS in 0.28s]
12:34:35  6 of 21 START test accepted_values_stg_students_with_credits_match_quality__False__0__1__2__3  [RUN]
12:34:35  7 of 21 START test dbt_expectations_expect_column_values_to_be_between_stg_students_with_credits_earned_credits__30__0  [RUN]
12:34:35  8 of 21 START test not_null_stg_students_with_credits_ImmaJahr ................. [RUN]
12:34:35  5 of 21 PASS accepted_values_stg_students_with_credits_StudienOrdnungJahr__False__11__18  [PASS in 0.15s]
12:34:35  9 of 21 START test not_null_stg_students_with_credits_ImmaSemester ............. [RUN]
12:34:35  8 of 21 PASS not_null_stg_students_with_credits_ImmaJahr ....................... [PASS in 0.19s]
12:34:35  10 of 21 START test not_null_stg_students_with_credits_Jahr .................... [RUN]
12:34:35  7 of 21 PASS dbt_expectations_expect_column_values_to_be_between_stg_students_with_credits_earned_credits__30__0  [PASS in 0.21s]
12:34:35  11 of 21 START test not_null_stg_students_with_credits_Modulnamen .............. [RUN]
12:34:35  6 of 21 PASS accepted_values_stg_students_with_credits_match_quality__False__0__1__2__3  [PASS in 0.23s]
12:34:35  12 of 21 START test not_null_stg_students_with_credits_Modulnummer ............. [RUN]
12:34:36  9 of 21 PASS not_null_stg_students_with_credits_ImmaSemester ................... [PASS in 0.20s]
12:34:36  13 of 21 START test not_null_stg_students_with_credits_NichtImPlan ............. [RUN]
12:34:36  10 of 21 PASS not_null_stg_students_with_credits_Jahr .......................... [PASS in 0.14s]
12:34:36  14 of 21 START test not_null_stg_students_with_credits_Semester ................ [RUN]
12:34:36  11 of 21 PASS not_null_stg_students_with_credits_Modulnamen .................... [PASS in 0.17s]
12:34:36  15 of 21 START test not_null_stg_students_with_credits_Status .................. [RUN]
12:34:36  12 of 21 PASS not_null_stg_students_with_credits_Modulnummer ................... [PASS in 0.16s]
12:34:36  16 of 21 START test not_null_stg_students_with_credits_StudienOrdnungJahr ...... [RUN]
12:34:36  13 of 21 PASS not_null_stg_students_with_credits_NichtImPlan ................... [PASS in 0.11s]
12:34:36  17 of 21 START test not_null_stg_students_with_credits_Studienrichtung ......... [RUN]
12:34:36  14 of 21 PASS not_null_stg_students_with_credits_Semester ...................... [PASS in 0.12s]
12:34:36  18 of 21 START test not_null_stg_students_with_credits_earned_credits .......... [RUN]
12:34:36  16 of 21 PASS not_null_stg_students_with_credits_StudienOrdnungJahr ............ [PASS in 0.09s]
12:34:36  19 of 21 START test not_null_stg_students_with_credits_match_quality ........... [RUN]
12:34:36  17 of 21 PASS not_null_stg_students_with_credits_Studienrichtung ............... [PASS in 0.09s]
12:34:36  20 of 21 START test not_null_stg_students_with_credits_studentID ............... [RUN]
12:34:36  15 of 21 PASS not_null_stg_students_with_credits_Status ........................ [PASS in 0.16s]
12:34:36  21 of 21 START test not_null_stg_students_with_credits_term_counter ............ [RUN]
12:34:36  18 of 21 PASS not_null_stg_students_with_credits_earned_credits ................ [PASS in 0.13s]
12:34:36  19 of 21 PASS not_null_stg_students_with_credits_match_quality ................. [PASS in 0.10s]
12:34:36  20 of 21 PASS not_null_stg_students_with_credits_studentID ..................... [PASS in 0.08s]
12:34:36  21 of 21 PASS not_null_stg_students_with_credits_term_counter .................. [PASS in 0.12s]
12:34:36
12:34:36  Finished running 21 data tests in 0 hours 0 minutes and 1.12 seconds (1.12s).
12:34:36
12:34:36  Completed successfully
----

=== Interpretation

* **21 Tests erfolgreich bestanden** → alle Datenkonsistenz-, Wertebereichs- und ENUM-Prüfungen wurden erfüllt.  
* **`accepted_values_*`-Tests** prüfen ENUM-Felder (z. B. `Semester`, `Status`).
* **`not_null_*`-Tests** stellen sicher, dass keine kritischen Felder leer sind.
* **`dbt_expectations_expect_column_values_to_be_between`** kontrolliert Wertebereiche (z. B. Credit-Summen ≤ 30).

Damit ist die Modellschicht `stg_students_with_credits` formal verifiziert und konsistent mit den definierten Datenqualitäts- und Typvorgaben.



== Fazit

Die Modelle `stg_students_clean` und `stg_students_with_credits` bilden die Grundlage für alle analytischen Auswertungen in der QIS-Insights-Pipeline.  
Sie gewährleisten:

* **Hohe Datenqualität** durch Validierungen und ENUM-Definitionen  
* **Nachvollziehbarkeit** durch klar strukturierte Spalten und Tests  
* **Erweiterbarkeit** für nachgelagerte analytische Modelle, Machine Learning oder Dashboards

